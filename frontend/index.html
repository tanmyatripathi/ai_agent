<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creator AI Co-Pilot</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .upload-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px 20px;
            margin-bottom: 20px;
            background: #f8f9ff;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: #f0f2ff;
        }

        .upload-area.dragover {
            border-color: #764ba2;
            background: #e8ebff;
        }

        .upload-icon {
            font-size: 3em;
            margin-bottom: 15px;
            color: #667eea;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-right: 10px;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
        }

        .upload-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .analyze-btn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .analyze-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(17, 153, 142, 0.3);
        }

        .analyze-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .text-input {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 20px;
        }

        .text-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .tab-buttons {
            display: flex;
            margin-bottom: 30px;
            background: #f5f7fa;
            border-radius: 10px;
            padding: 5px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .tab-btn.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            margin-top: 30px;
        }

        .result-section {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .result-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .theme-item, .idea-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .raw-response {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            margin-top: 20px;
        }

        .error {
            background: #fed7e2;
            color: #c53030;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #e53e3e;
        }

        .success-badge {
            background: #c6f6d5;
            color: #2f855a;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 15px;
        }

        .file-info {
            background: #e6fffa;
            color: #234e52;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef } = React;

        const CreatorAICopilot = () => {
            const [activeTab, setActiveTab] = useState('file');
            const [file, setFile] = useState(null);
            const [textComments, setTextComments] = useState('');
            const [results, setResults] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [dragOver, setDragOver] = useState(false);
            const fileInputRef = useRef(null);

            const handleFileSelect = (selectedFile) => {
                if (selectedFile && (selectedFile.type === 'text/plain' || selectedFile.name.endsWith('.txt') || selectedFile.name.endsWith('.csv'))) {
                    setFile(selectedFile);
                    setError(null);
                } else {
                    setError('Please select a valid .txt or .csv file');
                }
            };

            const handleDragOver = (e) => {
                e.preventDefault();
                setDragOver(true);
            };

            const handleDragLeave = (e) => {
                e.preventDefault();
                setDragOver(false);
            };

            const handleDrop = (e) => {
                e.preventDefault();
                setDragOver(false);
                const droppedFile = e.dataTransfer.files[0];
                if (droppedFile) {
                    handleFileSelect(droppedFile);
                }
            };

            const analyzeComments = async () => {
                setLoading(true);
                setError(null);
                setResults(null);

                try {
                    let response;
                    
                    if (activeTab === 'file' && file) {
                        const formData = new FormData();
                        formData.append('file', file);
                        
                        response = await fetch('http://127.0.0.1:8000/api/analyze-comments', {
                            method: 'POST',
                            body: formData,
                        });
                    } else if (activeTab === 'text' && textComments.trim()) {
                        response = await fetch('http://127.0.0.1:8000/api/analyze-text', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ comments: textComments }),
                        });
                    } else {
                        setError('Please provide comments to analyze');
                        setLoading(false);
                        return;
                    }

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.detail || 'Analysis failed');
                    }

                    const data = await response.json();
                    setResults(data);
                } catch (err) {
                    console.error('Analysis error:', err);
                    if (err.message.includes('fetch')) {
                        setError('Cannot connect to backend. Make sure the FastAPI server is running on http://localhost:8000');
                    } else {
                        setError(err.message);
                    }
                } finally {
                    setLoading(false);
                }
            };

            const canAnalyze = () => {
                return (activeTab === 'file' && file) || (activeTab === 'text' && textComments.trim());
            };

            return (
                <div className="container">
                    <div className="header">
                        <h1>üé•ü§ñ Creator AI Co-Pilot</h1>
                        <p>Judgment-free, time-saving content creation insights</p>
                    </div>

                    <div className="main-card">
                        <div className="tab-buttons">
                            <button 
                                className={`tab-btn ${activeTab === 'file' ? 'active' : ''}`}
                                onClick={() => setActiveTab('file')}
                            >
                                üìÅ Upload File
                            </button>
                            <button 
                                className={`tab-btn ${activeTab === 'text' ? 'active' : ''}`}
                                onClick={() => setActiveTab('text')}
                            >
                                ‚úèÔ∏è Paste Text
                            </button>
                        </div>

                        {activeTab === 'file' && (
                            <div className="upload-section">
                                <div 
                                    className={`upload-area ${dragOver ? 'dragover' : ''}`}
                                    onDragOver={handleDragOver}
                                    onDragLeave={handleDragLeave}
                                    onDrop={handleDrop}
                                    onClick={() => fileInputRef.current?.click()}
                                >
                                    <div className="upload-icon">üì§</div>
                                    <h3>Drop your comments file here</h3>
                                    <p>or click to browse (.txt or .csv files)</p>
                                    {file && (
                                        <div className="file-info">
                                            ‚úÖ Selected: {file.name} ({Math.round(file.size / 1024)} KB)
                                        </div>
                                    )}
                                </div>
                                <input
                                    ref={fileInputRef}
                                    type="file"
                                    accept=".txt,.csv"
                                    onChange={(e) => handleFileSelect(e.target.files[0])}
                                    className="file-input"
                                />
                            </div>
                        )}

                        {activeTab === 'text' && (
                            <div className="upload-section">
                                <textarea
                                    className="text-input"
                                    placeholder="Paste your comments here... (one comment per line)

Example:
Great video!
Loved the tips.
Can you do more about college life?
This was so helpful, thank you!"
                                    value={textComments}
                                    onChange={(e) => setTextComments(e.target.value)}
                                />
                                <div style={{ textAlign: 'right', fontSize: '14px', color: '#666', marginTop: '-15px', marginBottom: '15px' }}>
                                    {textComments.split('\n').filter(line => line.trim()).length} comments
                                </div>
                            </div>
                        )}

                        <div style={{ textAlign: 'center' }}>
                            <button 
                                className="analyze-btn"
                                onClick={analyzeComments}
                                disabled={!canAnalyze() || loading}
                            >
                                {loading ? 'ü§ñ Analyzing...' : '‚ú® Analyze Comments'}
                            </button>
                        </div>

                        {error && (
                            <div className="error">
                                ‚ùå {error}
                            </div>
                        )}

                        {loading && (
                            <div className="loading">
                                <div className="spinner"></div>
                                <p>AI is analyzing your comments with LLaMA-3...</p>
                            </div>
                        )}

                        {results && (
                            <div className="results">
                                <div className="success-badge">
                                    ‚úÖ Analysis Complete ‚Ä¢ {results.comment_count} comments analyzed
                                </div>

                                <div className="result-section">
                                    <h3>üéØ Top Viewer Themes</h3>
                                    {results.themes.map((theme, index) => (
                                        <div key={index} className="theme-item">
                                            <strong>{index + 1}.</strong> {theme}
                                        </div>
                                    ))}
                                </div>

                                <div className="result-section">
                                    <h3>üí° Suggested Content Ideas</h3>
                                    {results.content_ideas.map((idea, index) => (
                                        <div key={index} className="idea-item">
                                            <strong>{index + 1}.</strong> {idea}
                                        </div>
                                    ))}
                                </div>

                                {results.raw_response && (
                                    <details style={{ marginTop: '20px' }}>
                                        <summary style={{ cursor: 'pointer', padding: '10px 0', fontWeight: '600' }}>
                                            ü§ñ View Raw AI Response
                                        </summary>
                                        <div className="raw-response">
                                            {results.raw_response}
                                        </div>
                                    </details>
                                )}
                            </div>
                        )}
                    </div>

                    <div style={{ textAlign: 'center', color: 'white', opacity: '0.8', marginTop: '20px' }}>
                        <p>Powered by Ollama + LLaMA-3 ‚Ä¢ Running locally for privacy</p>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<CreatorAICopilot />, document.getElementById('root'));
    </script>
</body>
</html>